<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Chargement du planning...</h1>

  <script>
    const supabase = window.supabase.createClient(
      "TON_URL_SUPABASE_ICI",
      "TA_CLÉ_ANON_ICI"
    );

    let user = null;
    let planningId = null;
    let planningData = null;

    async function init() {
      // Vérifier la session
      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        window.location.href = "Login.html";
        return;
      }

      user = data.session.user;

      // Charger le planning
      const { data: planning, error } = await supabase
        .from("plannings")
        .select("*")
        .eq("user_id", user.id)
        .single();

      if (error && error.code !== "PGRST116") {
        document.body.innerHTML = "<h2>Erreur : " + error.message + "</h2>";
        return;
      }

      if (!planning) {
        // Créer un planning vide
        const defaultData = {
          globalNotes: "",
          checklist: [],
          days: [
            { day: "Lundi", tag: "Démarrage en douceur", notes: "", slots: baseSlots() },
            { day: "Mardi", tag: "Activités régulières", notes: "", slots: baseSlots() },
            { day: "Mercredi", tag: "Milieu de semaine", notes: "", slots: baseSlots() },
            { day: "Jeudi", tag: "Rythme stable", notes: "", slots: baseSlots() },
            { day: "Vendredi", tag: "Fin de semaine", notes: "", slots: baseSlots() },
            { day: "Samedi", tag: "Temps perso / loisirs", notes: "", slots: baseSlots() },
            { day: "Dimanche", tag: "Repos / préparation", notes: "", slots: baseSlots() }
          ]
        };

        const { data: newPlanning } = await supabase
          .from("plannings")
          .insert({
            user_id: user.id,
            data: defaultData
          })
          .select()
          .single();

        planningId = newPlanning.id;
        planningData = newPlanning.data;
      } else {
        planningId = planning.id;
        planningData = planning.data;
      }

      // Charger ton planning pastel
      loadPlanningUI();
    }

    function baseSlots() {
      return [
        { label: "Matin", activities: [] },
        { label: "Midi", activities: [] },
        { label: "Soir", activities: [] }
      ];
    }

    async function savePlanning() {
      await supabase
        .from("plannings")
        .update({ data: planningData })
        .eq("id", planningId);
    }

    function loadPlanningUI() {
  document.body.innerHTML = `
    <div class="container">
      ...
    </div>
  `;

  <div class="container">
    <header>
      <h1>Planning d’activités</h1>
      <button id="logoutBtn" class="logout">Déconnexion</button>
    </header>

    <section class="global-notes">
      <h2>Notes globales</h2>
      <textarea id="globalNotes"></textarea>
    </section>

    <section class="week">
      ${planningData.days.map((day, index) => `
        <div class="day-card" data-day-index="${index}">
          <h3>${day.day}</h3>
          <input class="tag-input" value="${day.tag}" placeholder="Tag du jour" />

          <div class="slots">
            ${day.slots.map((slot, sIndex) => `
              <div class="slot" data-slot-index="${sIndex}">
                <h4>${slot.label}</h4>
                <ul class="activities">
                  ${slot.activities.map((act, aIndex) => `
                    <li>
                      <input class="activity-input" data-activity-index="${aIndex}" value="${act}" />
                      <button class="delete-activity">×</button>
                    </li>
                  `).join("")}
                </ul>
                <button class="add-activity">+ Ajouter une activité</button>
              </div>
            `).join("")}
          </div>

          <textarea class="day-notes" placeholder="Notes du jour">${day.notes}</textarea>
        </div>
      `).join("")}
    </section>

    <section class="checklist">
      <h2>Checklist</h2>
      <ul id="checklist">
        ${planningData.checklist.map((item, i) => `
          <li>
            <input type="checkbox" ${item.checked ? "checked" : ""} data-index="${i}" />
            <input class="check-text" value="${item.text}" />
            <button class="delete-check">×</button>
          </li>
        `).join("")}
      </ul>
      <button id="addCheck">+ Ajouter une tâche</button>
    </section>
  </div>
`;
    }

    init();
  </script>
</body>
</html>
