<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Chargement du planning...</h1>

  <script>
    const supabase = window.supabase.createClient(
      "TON_URL_SUPABASE_ICI",
      "TA_CLÉ_ANON_ICI"
    );

    let user = null;
    let planningId = null;
    let planningData = null;

    async function init() {
      // Vérifier la session
      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        window.location.href = "login.html";
        return;
      }

      user = data.session.user;

      // Charger le planning
      const { data: planning, error } = await supabase
        .from("plannings")
        .select("*")
        .eq("user_id", user.id)
        .single();

      if (error && error.code !== "PGRST116") {
        document.body.innerHTML = "<h2>Erreur : " + error.message + "</h2>";
        return;
      }

      if (!planning) {
        // Créer un planning vide
        const defaultData = {
          globalNotes: "",
          checklist: [],
          days: [
            { day: "Lundi", tag: "Démarrage en douceur", notes: "", slots: baseSlots() },
            { day: "Mardi", tag: "Activités régulières", notes: "", slots: baseSlots() },
            { day: "Mercredi", tag: "Milieu de semaine", notes: "", slots: baseSlots() },
            { day: "Jeudi", tag: "Rythme stable", notes: "", slots: baseSlots() },
            { day: "Vendredi", tag: "Fin de semaine", notes: "", slots: baseSlots() },
            { day: "Samedi", tag: "Temps perso / loisirs", notes: "", slots: baseSlots() },
            { day: "Dimanche", tag: "Repos / préparation", notes: "", slots: baseSlots() }
          ]
        };

        const { data: newPlanning } = await supabase
          .from("plannings")
          .insert({
            user_id: user.id,
            data: defaultData
          })
          .select()
          .single();

        planningId = newPlanning.id;
        planningData = newPlanning.data;
      } else {
        planningId = planning.id;
        planningData = planning.data;
      }

      // Charger ton planning pastel
      loadPlanningUI();
    }

    function baseSlots() {
      return [
        { label: "Matin", activities: [] },
        { label: "Midi", activities: [] },
        { label: "Soir", activities: [] }
      ];
    }

    async function savePlanning() {
      await supabase
        .from("plannings")
        .update({ data: planningData })
        .eq("id", planningId);
    }

    function loadPlanningUI() {
      // Ici, on remplace tout le body par ton planning pastel
      document.body.innerHTML = `
        <h2>Ton planning est chargé !</h2>
        <p>La version pastel complète arrive à la brique suivante.</p>
      `;
    }

    init();
  </script>
</body>
</html>
